<!DOCTYPE html5>
<html>
<head>
	<link rel="stylesheet" type="type/css" href="map.css">
	<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
</head>
<body>
	<table>
	<tr>
	<td>
	<div class="panel-container">
		<div class="left-panel">
			<ul>
			</ul>
		</div>
	</div>
	</td>
	<td>
	<canvas id="canvas" width="940" height="1024" style=""></canvas>
	</td>
	<!--
	<div class="right-panel">
		<ul>
			<li>RIGHT</li>
		</ul>
	</div>
	-->
	</tr>
</body>
</html>

<script>
var canvas = $("#canvas")[0];
var bg = canvas.getContext("2d");
var ctx = canvas.getContext("2d");
var canvasWidth = 940;//$("#canvas").attr('width');
var canvasHeight = 1024;//$("#canvas").attr('height');
var debugOn = true;

var img = new Image();
var cursor = new Image();
img.src = 'maps/canvas.png';
cursor.src = 'misc/cursor.png'; 
img.onload = function() {
	bg.drawImage(img,0,0,canvasWidth,canvasHeight);
	drawTestGrid(ctx);
}

var Place = function(name,x,y,src,info) {
	this.name = name;
	this.x = x;
	this.y = y;
	this.src = img;
	this.info = info;
	this.img = new Image();
	img.src = 'Campus_Buildings/{0}'.format(this.src);
}

var currentLocation = new Place('null',0,0,'alumni.jpg','null');

/* ------------------Test functions ----------------------*/
function drawTestGrid(context) {
	if (debugOn) {
		var offset = 50;
		context.strokeStyle = "black";
		for (var i = 0; i < canvasWidth; i+=offset) {
			context.beginPath();
			context.moveTo(i,0);
			context.lineTo(i,canvasHeight);
			context.stroke();
		}
		for (var i = 0; i < canvasHeight; i+=offset) {
			context.beginPath();
			context.moveTo(0,i);
			context.lineTo(canvasWidth,i);
			context.stroke();
		}
	}
}

function displayHoverRange(context) {
	if (debugOn) {
		context.beginPath();
		context.lineWidth="2";
		context.strokeStyle = "red";
		context.rect(currentLocation.x-12,currentLocation.y-25,50,50);
		context.stroke();
	}
}

/* -------------------------------------------------------*/
var locations = Array();

// Not difficult to do using jinja, but for the purposes of this demo, 
// we will fetch database information from a txt file.
$.get('database/canvas.txt', function(data) {
	var tuples = data.split('\n');
	for (var i = 0; i < tuples.length - 1; i++) {

		locations.push(new Place(tuples[i].split('|')[0],tuples[i].split('|')[1],tuples[i].split('|')[2],tuples[i].split('|')[3],tuples[i].split[4]));

			$('.left-panel ul').append('<li onclick="drawLocation('+i+')">'+locations[i].name+'</li>');
	}
	//console.log(locations);	
});

function clearScreen(context) {
	context.fillStyle = "#FFFFFF";
	context.fillRect(0,0,canvasWidth, canvasHeight);
}

function drawLocation(index) {
	console.log('Drawing Location for ' + locations[index].name);
	clearScreen(ctx);
	bg.drawImage(img,0,0,canvasWidth,canvasHeight);
	drawTestGrid(ctx);
	displayInformation(ctx);
	ctx.fillStyle = "#FF0000";
	ctx.drawImage(cursor,locations[index].x - 12,locations[index].y - 25,50,50);
	currentLocation = locations[index];
	displayHoverRange(ctx);
}

function displayInformation(context) {
	ctx.fillStyle = "#00FF00";
	ctx.fillRect(600,0,340,300);
}

$('.left-panel ul li').click(function(e) {
	drawLocation(ctx);
	displayInformation(ctx);
});
</script>
