<!DOCTYPE html5>
<html>
<head>
	<link rel="stylesheet" type="type/css" href="map.css">
	<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
</head>
<body>
	<table>
	<tr>
	<td>
	<div class="left-panel">
		<ul>
		</ul>
	</div>
	</td>
	<td>
	<canvas id="canvas" width="940" height="1024" style=""></canvas>
	</td>
	<!--
	<div class="right-panel">
		<ul>
			<li>RIGHT</li>
		</ul>
	</div>
	-->
	</tr>
</body>
</html>

<script>
var canvas = $("#canvas")[0];
var bg = canvas.getContext("2d");
var ctx = canvas.getContext("2d");
var canvasWidth = 940;//$("#canvas").attr('width');
var canvasHeight = 1024;//$("#canvas").attr('height');
var gridOn = false;

var img = new Image();
img.src = 'canvas.png';
img.onload = function() {
	bg.drawImage(img,0,0,canvasWidth,canvasHeight);
	drawTestGrid(ctx);
}

var Place = function(name,x,y) {
	this.name = name;
	this.x = x;
	this.y = y;
}

function drawTestGrid(context) {
	if (gridOn) {
		var offset = 50;
		for (var i = 0; i < canvasWidth; i+=offset) {
			context.beginPath();
			context.moveTo(i,0);
			context.lineTo(i,canvasHeight);
			context.stroke();
		}
		for (var i = 0; i < canvasHeight; i+=offset) {
			context.beginPath();
			context.moveTo(0,i);
			context.lineTo(canvasWidth,i);
			context.stroke();
		}
	}
}

var locations = Array();

// Not difficult to do using jinja, but for the purposes of this demo, 
// we will fetch database information from a txt file.
$.get('canvas.txt', function(data) {
	var tuples = data.split('\n');
	for (var i = 0; i < tuples.length - 1; i++) {

		locations.push(new Place(tuples[i].split('|')[0],tuples[i].split('|')[1],tuples[i].split('|')[2]));

		//if (i < (tuples.length - 1) / 2)
			$('.left-panel ul').append('<li onclick="drawLocation('+i+')">'+locations[i].name+'</li>');
/*		else
			$('.right-panel ul').append('<li onclick="drawLocation('+i+')">'+locations[i].name+'</li>');*/
	}
	console.log(locations);	
});

function clearScreen(context) {
	context.fillStyle = "#FFFFFF";
	context.fillRect(0,0,canvasWidth, canvasHeight);
}

function drawLocation(index) {
	console.log('Drawing Location for ' + locations[index].name);
	clearScreen(ctx);
	bg.drawImage(img,0,0,canvasWidth,canvasHeight);
	drawTestGrid(ctx);
	ctx.fillStyle = "#FF0000";
	ctx.fillRect(locations[index].x,locations[index].y,25,25);
}

$('.left-panel ul li').click(function(e) {
	drawLocation(ctx);
});
</script>
